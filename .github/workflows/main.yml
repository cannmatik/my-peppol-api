# .github/workflows/daily-update.yml

name: Peppol Directory Daily Update (Neon DB)

# BetiÄŸin ne zaman Ã§alÄ±ÅŸacaÄŸÄ±nÄ± tanÄ±mlar
on:
  # ğŸš¨ GÃœNCELLENEN KISIM: Her 3 saatte bir (UTC saatlerine gÃ¶re) Ã§alÄ±ÅŸtÄ±r.
  # Saatler (UTC): 00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00
  schedule:
    - cron: '0 0,3,6,9,12,15,18,21 * * *'
  # Manuel olarak Ã§alÄ±ÅŸtÄ±rma butonu ekler
  workflow_dispatch:

jobs:
  run_business_card_update:
    runs-on: ubuntu-latest
    
    # AdÄ±mlarÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± ortam
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20' # KullandÄ±ÄŸÄ±nÄ±z Node.js versiyonunu buraya yazÄ±n

    - name: Install dependencies
      run: npm install 
      # BetiÄŸinizde 'pg' ve 'fast-xml-parser' kullandÄ±ÄŸÄ±nÄ±z iÃ§in bu adÄ±m gerekli.
      # EÄŸer package.json dosyanÄ±z bu seviyede deÄŸilse, 'cd app && npm install' gibi yolu ayarlayÄ±n.

    - name: Run Business Cards Update Script
      # BetiÄŸinizi Ã§alÄ±ÅŸtÄ±rÄ±r ve NEON_DATABASE_URL secret'Ä±nÄ± ortam deÄŸiÅŸkeni olarak ekler
      run: node src/scripts/BusinessCards.js 
      # Dosya yolunu doÄŸru olduÄŸundan emin olun! (Ã–rn: node BusinessCards.js veya node src/BusinessCards.js)
      env:
        NEON_DATABASE_URL: ${{ secrets.NEON_DATABASE_URL }}
        # BetiÄŸinizde tanÄ±mlÄ± olan diÄŸer .env deÄŸiÅŸkenleri varsa, onlarÄ± da ekleyin.
        
    - name: Cleanup (Log)
      # BaÅŸarÄ±lÄ± olursa temizlik logunu gÃ¶sterir
      if: success()
      run: echo "Update job completed successfully and table swapped."
      
    - name: Failure Notification (Log)
      # Hata olursa logu gÃ¶sterir
      if: failure()
      run: echo "Update job failed. Check logs for details."
